Bootstrap: docker
From: ubuntu:18.04

%files
    yml/*yml /
    tiara_post_filter_prokaregia.sh /prokaregia.sh
    prokaregia_graph_simplified.py /prokaregia_graph.py


%post
    apt-get update
    apt-get install -y gcc wget git
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh -O miniconda.sh
    bash miniconda.sh -b -p /opt/miniconda
    export PATH="/opt/miniconda/bin:$PATH"
    echo ". /opt/miniconda/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
    for i in *yml; do
      conda env create -f $i
    done
    conda clean --all

    chmod +x /prokaregia.sh prokaregia_graph_simplified.py
    . /opt/miniconda/etc/profile.d/conda.sh
    conda activate checkm2
    checkm2 database download
    
%environment
    export LC_ALL=C
    export LC_NUMERIC=en_GB.UTF-8
    export PATH="/opt/miniconda/bin:$PATH"
    PATH=/:$PATH
    source /opt/miniconda/etc/profile.d/conda.sh
